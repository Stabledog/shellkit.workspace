# taskrc for shellkit.workspace
# vim: filetype=sh :

# If someone does a raw "source taskrc", we ensure that $taskrc_dir gets defined anyway
[[ -z $taskrc_dir && -f ./taskrc ]] && export taskrc_dir=$PWD

type -t localhist_set >/dev/null && {
    alias tkr-lh="localhist_set ${taskrc_dir}/bash_history"
    #Help: tkr-lh sets localhist to ${taskrc_dir}
}

tmk() {
#Help: tmk help -- list targets; tmk -e -- edit taskrc.mk
    [[ $1 == "-e" ]] || [[ $1 == "--edit" ]] && {
        shift
        vim $taskrc_dir/taskrc.mk "$@"
    } || {
        make -C ${taskrc_dir} -f ${taskrc_dir}/taskrc.mk "$@"
    }
}

grepall() {
    #Help search all git-controlled files for pattern $@
    grepall_pattern="$*" tmk -s grepall
}

devcode() {
    #Help open the workspace in vscode devcontainer
    [[ -f bb-shellkit/environ/ ]] && {
        ln -sf bb-shellkit/environ/shellkit-workspace-environment.mk.$(hostname) ${taskrc_dir}/environment.mk
    }
    devcontainer open ${taskrc_dir}
}

docker_install_all_kits() {
#Help Install all kits from the host's ~/.local/bin
    make -C ${taskrc_dir} -f ${taskrc_dir}/Makefile docker-install-all-kits && \
    source ~/.bashrc ; \
    echo Shell reloaded.
}


